---
title: "A Study on A Home Team's Performance Relative to the Importance of Their Game"
author: "Jordy Chaves"
description: "How Barclay's Premier League clubs' forms in the 2016-2017 season were influenced by the importance of their games."
output:
  distill::distill_article:
    self_contained: false
---

# Introduction

  Does the importance of a soccer game influence whether or not a home team wins a game? In this study, I want to observe the relationship between a match's importance to a home team and the result of that match for the team. I hypothesize that as a match increases in importance, a home team will be more likely to get a positive result from their game. A positive result in this study is defined as a win or draw since wins are the results that yield the most points for a team. (3 points). A negative result is defined as a loss or a draw (0 points and 1 point respectively) because the team failed to capitalize on all the points for the offering. My sample for this study is comprised of the 20 Barclay's Premier League teams in the 2016-2017 season. I will be using the `spi.matches.csv` dataset to in this research. My unit of analysis will be a home team (for each individual game). The explanatory variable of interest is how important a game is to a home team (importance1 measures the importance of a home team). The explanatory variable is measured on a scale of 0-100, 0 meaning not important and 100 meaning the most important. My outcome variable is the results of a game for a home team. If I observe a positive linear relationship between the importance of a match to a home team and the result, then this will provide support for my hypothesis. If there is a negative relationship, then this would provide support against my hypothesis as this would mean that the more important the game, the less a home team wins.
  
  The study is important in order to try and understand how best to predict a sports game. There are many variables that go into predicting the result of a soccer match, but if we can isolate the importance of a game as the explanatory variable, then we will can form more accurate predictions. From the study, one could even start attempting to see these trends in other seasons and leagues to see if it remains valid.
  
# Data

As aforementioned, the data I am using for this study comes from the `spi.matches.csv` dataset. The names and descriptions of the variables included in this dataset are shown below. For this study, it is important to preface that the SPI (Soccer Power Index) ratings of the teams are generated by ESPN's rating system and is designed to best represent a team's current skill level. It is described as forward-looking and predictive. Additionally, this is an observational study as opposed to a randomized control trial. The outcome (result of the game) is not randomly assigned by chance. We are observing past results that were a result of many different variables that go into a soccer game. This observational study can help us generalize those performances for all teams in the Barclay's Premier League. 

Name                 Description
-------------------- -------------------------------------------------------------------------------------
`season`              The season during which the match was played. 
`date`                The date of the match (YYYY-MM-DD).
`league_id`           A unique identifier for the league this match was played in.
`league`             Name of the league this match was played in.      
`team1`              The home team's name.
`team2`              The away team's name.
`spi1`               The home team's overall SPI rating before the match.
`spi2`               The away team's overall SPI rating before the match.
`prob1`              The probability of the home team winning the match.
`prob2`              The probability of the away team winning the match.
`probtie`            The probability of match ending in a draw. (if applicable)
`proj_score1`        The number of goals we expected the home. team to score
`proj_score2`        The number of goals we expected the away. team to score
`importance1`        The importance of the match for the home. team (0-100).
`importance2`        The importance of the match for the away. team (0-100).
`score1`             The number of goals scored by the home. team.
`score2`             The number of goals scored by the away. team.
`xg1`                The number of expected goals created by the home team.
`xg2`                The number of expected goals created by the away team.
`nsxg1`              The number of non-shot expected goals created by the home team.
`nsxg2`              The number of non-shot expected goals created by the away team.
`adj_score1`          The number of goals scored by the home team, adjusted for game state.
`adj_score2`          The number of goals scored by the away team, adjusted for game state.

## Loading the data

```{r}
library(dplyr)
library(tidyverse)
library(ggplot2)
Data <- read_csv("Data/spi_matches.csv")
Data
```

## Subsetting the Data to Focus on the 2016 Barclay's Premier League Season and Creating New Variables

Because the scope of this study is on the 2016-2017 English Premier League, the data I am using needed to be filtered. To do that, I set the variable `league` to "Barclay's Premier League" and `season` to "2016". Additionally, because this study is focused on the results of a home team, new variables had to be added to the data to assess the relationship between game importance and the results of those games. The new variable that I created in the study was `result1`. It is a binary variable that assigns `1` to games where the home team won and `0` to games where the home team either lost or tied. This was done by taking the `score1` and `score2` variables and using logical statements to represent wins, draws, and losses.


```{r}
Data <- Data |>
  drop_na()

pl_table_2016 <- Data |>
  filter(league == "Barclays Premier League", season == "2016") |>
  mutate(result = case_when(score1 > score2 ~ " Home Win",
                            score1 < score2 ~ "Home Loss",
                            score2 == score1 ~ "Draw"),
         result1 = case_when(score1 > score2 ~ 1,
                            score1 < score2 ~ 0,
                            score2 == score1 ~ 0)) |>
  group_by(importance1)
pl_table_2016
```  

## Histogram of Games and Their Importance

```{r}
pl_importance <- ggplot(data = pl_table_2016, mapping = aes(x = importance1)) +
    geom_histogram(fill = "deepskyblue3") +
    labs(x = "Degree of Importance of a Game to the Home Team", y = "Count", title = "Count of Games and How Important They Are") +
  theme_bw() +
  geom_vline(aes(xintercept = mean(pl_table_2016$importance1)), color = "red2")
  
pl_importance
```

This histogram visualizes the spread of the importance of games. In the data, there are certainly more games that are less important than important. Most of the data is skewed to the left of the histogram. The vertical line shows the mean of the importance of games to a home team, which is about 37. So an average game's importance was about 37 points out of 100. Could this perhaps skew the data as there are more 

## Table of the Home Team's Results 

```{r}
count_table <- pl_table_2016 |>
  group_by(result) |>
  summarize(n = n())

knitr::kable(count_table, col.names = c("Result of Home Games", "Total Count"))

```

This table breaks down the total number of each results that are included in the data. Out of the 344 total games observed in the data, there are 166 home wins, 76 draws, and 102 home losses. In terms of negative and positive results, there are more negative results than positive results. 

## Scatterplot of the Results of a Game in Relation to the Importance of that Game to a Home Team

```{r} 
pl_importance_results <- ggplot(data = pl_table_2016, mapping = aes(x = importance1, y = result1)) +
  geom_point(alpha = 0.3, color = "navy") +
  theme_bw() +
  geom_smooth(method = "lm", color = "dodgerblue2", fill = "skyblue") +
  labs(x = "Importance of the game to a Home Team", y = "Result of the Game (1 = win and 0 = loss/draw)", title = "Results of Games in Relation to the Importance of the Game to a Home Team")

pl_importance_results
```

The main outcome of interest is the result of home teams' games in relation to the game's importance. The points on the scatter plot are on y = 0 and y = 1, because the result variable is a binary. 0 meaning a negative result (loss or a draw) and 1 meaning a positive result (win). The plot shows a higher congregation of negative results when the importance of the game is lower and a higher congregation of positive results when the importance is greater. The regression line shows the positive association between the importance of games and its results for the home team. From this plot, the hypothesis can be substantiated, but this is done without adjusting for any confounding variables that might be influencing the plot. But from this initial observation of the main outcome of interest, there seems to be evidence in favor of the hypothesis.

## Confounders

### The Home Team's Projected Score

```{r}
proj_score_point <- pl_table_2016 |>
  ggplot(aes(x = proj_score1, y = result1)) +
  geom_point(alpha = 0.3, color = "seagreen4") +
  labs(x = "Projected Goals in a Game by the Home Team", y = "Result of the Game (1 = win and 0 = loss/draw)", title = "Plot of the Relationship Between Projected Score and the Result of a Game") +
  theme_bw() +
  geom_smooth(method = "lm", color = "cadetblue3", fill = "lightcyan2")

proj_score_point
```

```{r}
proj_score_point1 <- pl_table_2016 |>
  ggplot(aes(x = proj_score1, y = importance1)) +
  geom_point(alpha = 0.3, color = "seagreen4") +
  labs(x = "Projected Goals in a Game by the Home Team", y = "Importance of Games", title = "Plot of the Relationship Between Projected Score and the Importance of a Game") +
  theme_bw() +
  geom_smooth(method = "lm", color = "darkorchid4", fill = "orchid")

proj_score_point1
```



### SPI Rating of the Home Team

```{r}
spi_rating_plot <- pl_table_2016 |>
  ggplot(aes(x = spi1, y = result1)) +
  geom_point(alpha = 0.3, color = "maroon") +
  labs(x = "SPI Rating of the Home Team", y = "Result of the Game (1 = win and 0 = loss/draw)",title = "Relationship Between Soccer Power Index Rating (SPI) and the Result of a Game") +
  theme_bw() +
  geom_smooth(method = "lm", color = "slateblue4", fill = "lightslateblue")

spi_rating_plot
```

With the experiment, I wanted to account for potential confounding variables that would most influence the results of the games and the importance of the game. Two confounding variables I chose to analyze were the projected score for the home team and the home team's Soccer Power Index (SPI) rating before the game. The projected score could influence the result as a smaller projected score for the home team could lead to a negative result. The projected score may also be a reflection of the importance of a game as a higher projected score may mean a higher importance as teams have that pressure to achieve what is projected for them. SPI rating can make influence the result as a lower rated team may falter to higher rated team and the SPI rating might reflect the importance of the match. Facing similarly rated or worse-rated opposition may make it more imperative for teams to get a positive result. Facing higher opposition would mean a game is less important because they are not as likely to win. 

# Results

### Plot of Main Analysis



### Regression Output

```{r}
library(texreg)
fit1 <- lm(result1 ~ importance1 + importance2 + xg1 + xg2 + spi1 + spi2 + prob1 + prob2 + probtie, data = pl_table_2016)



fit2 <- lm(result1 ~ importance1, data = pl_table_2016)

library(broom)
fit1_table <- tidy(fit1)
fit1_table

pl_var_labels <- c("(Intercept)" = "Intercept",
                  "importance1" = "Match Importance to Home Team",
                  "importance2" = "Match Importance to Away Team",
                  "xg1" = "Home Team Expected Goals",
                  "xg2" = "Away Team Expected Goals",
                  "spi1" = "Home Team's Rating Before the Match",
                  "spi2" = "Away Team's Rating Before the Match",
                  "prob1" = "Probability of Home Team Winning",
                  "prob2" = "Probability of Away Team Winning",
                  "probtie" = "Probability of a Tie"
)

modelsummary::modelsummary(fit1, statistic = c("s.e. = {std.error}", "p = {p.value}"), coef_map = pl_var_labels, gof_map = c("nobs", "r.squared", "adj.r.squared"), fmt = 3)
```


# Conclusion

The purpose of this study was to observe the relationship between the importance of games to a Barclay's Premier League home team and the result of those games in the 2016-2017 season. I hypothesized that as the importance of the games increased, teams would get more wins than losses/draws. As 

Given more time and money, I would improve this analysis by broadening the scope of this study to other soccer leagues across the world. Being that it is an observational study, broadening the scope can help improve its external validity or perhaps refute its external validity. 
